<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker入门 | The Note of HelloWorldYC</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/Note/images/myfavicon.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/Note/assets/css/0.styles.e7ea4a54.css" as="style"><link rel="preload" href="/Note/assets/js/app.1ed639b6.js" as="script"><link rel="preload" href="/Note/assets/js/3.e49e4a19.js" as="script"><link rel="preload" href="/Note/assets/js/23.3bc1de70.js" as="script"><link rel="prefetch" href="/Note/assets/js/10.bfd4e14e.js"><link rel="prefetch" href="/Note/assets/js/11.27b208a4.js"><link rel="prefetch" href="/Note/assets/js/12.cd2b952f.js"><link rel="prefetch" href="/Note/assets/js/13.6a1ec2bc.js"><link rel="prefetch" href="/Note/assets/js/14.fbcb7cdc.js"><link rel="prefetch" href="/Note/assets/js/15.557c9880.js"><link rel="prefetch" href="/Note/assets/js/16.fc27613a.js"><link rel="prefetch" href="/Note/assets/js/17.c27bd92c.js"><link rel="prefetch" href="/Note/assets/js/18.ed4c0fb1.js"><link rel="prefetch" href="/Note/assets/js/19.78636a15.js"><link rel="prefetch" href="/Note/assets/js/2.8d67c785.js"><link rel="prefetch" href="/Note/assets/js/20.19b62d82.js"><link rel="prefetch" href="/Note/assets/js/21.4d8ab525.js"><link rel="prefetch" href="/Note/assets/js/22.20b764ae.js"><link rel="prefetch" href="/Note/assets/js/24.6086db17.js"><link rel="prefetch" href="/Note/assets/js/25.4943cf08.js"><link rel="prefetch" href="/Note/assets/js/26.47613b37.js"><link rel="prefetch" href="/Note/assets/js/27.2cdf1b0e.js"><link rel="prefetch" href="/Note/assets/js/28.687c8f5d.js"><link rel="prefetch" href="/Note/assets/js/29.e30104dc.js"><link rel="prefetch" href="/Note/assets/js/30.9f75dbc4.js"><link rel="prefetch" href="/Note/assets/js/31.53495b4e.js"><link rel="prefetch" href="/Note/assets/js/32.b064195e.js"><link rel="prefetch" href="/Note/assets/js/33.d52a6a9e.js"><link rel="prefetch" href="/Note/assets/js/34.f6f446f1.js"><link rel="prefetch" href="/Note/assets/js/35.37fa5673.js"><link rel="prefetch" href="/Note/assets/js/36.1fc68547.js"><link rel="prefetch" href="/Note/assets/js/37.984ed9eb.js"><link rel="prefetch" href="/Note/assets/js/38.1b9138ad.js"><link rel="prefetch" href="/Note/assets/js/39.b5dbb781.js"><link rel="prefetch" href="/Note/assets/js/4.3e6161de.js"><link rel="prefetch" href="/Note/assets/js/40.c79ac710.js"><link rel="prefetch" href="/Note/assets/js/41.3d386d1f.js"><link rel="prefetch" href="/Note/assets/js/42.0233498c.js"><link rel="prefetch" href="/Note/assets/js/43.3b97b0df.js"><link rel="prefetch" href="/Note/assets/js/44.9632e7ea.js"><link rel="prefetch" href="/Note/assets/js/45.9b398499.js"><link rel="prefetch" href="/Note/assets/js/46.a5018363.js"><link rel="prefetch" href="/Note/assets/js/47.298df2d6.js"><link rel="prefetch" href="/Note/assets/js/48.edcc22b0.js"><link rel="prefetch" href="/Note/assets/js/49.5176fb07.js"><link rel="prefetch" href="/Note/assets/js/5.72ac0e8a.js"><link rel="prefetch" href="/Note/assets/js/50.4bcd07ae.js"><link rel="prefetch" href="/Note/assets/js/51.b2e8342e.js"><link rel="prefetch" href="/Note/assets/js/52.3b3312d7.js"><link rel="prefetch" href="/Note/assets/js/53.f3e51ded.js"><link rel="prefetch" href="/Note/assets/js/54.a671680b.js"><link rel="prefetch" href="/Note/assets/js/55.56105d28.js"><link rel="prefetch" href="/Note/assets/js/56.db7ab4e3.js"><link rel="prefetch" href="/Note/assets/js/57.9a233b59.js"><link rel="prefetch" href="/Note/assets/js/58.c8c29b41.js"><link rel="prefetch" href="/Note/assets/js/59.4c8550e6.js"><link rel="prefetch" href="/Note/assets/js/6.9603718e.js"><link rel="prefetch" href="/Note/assets/js/60.7f1e3298.js"><link rel="prefetch" href="/Note/assets/js/61.be40a50a.js"><link rel="prefetch" href="/Note/assets/js/62.e4472a16.js"><link rel="prefetch" href="/Note/assets/js/63.fd6117b9.js"><link rel="prefetch" href="/Note/assets/js/64.641d0112.js"><link rel="prefetch" href="/Note/assets/js/65.5da1e58d.js"><link rel="prefetch" href="/Note/assets/js/66.36affca8.js"><link rel="prefetch" href="/Note/assets/js/67.7c07631f.js"><link rel="prefetch" href="/Note/assets/js/68.f28577c9.js"><link rel="prefetch" href="/Note/assets/js/69.abab7a05.js"><link rel="prefetch" href="/Note/assets/js/7.41029419.js"><link rel="prefetch" href="/Note/assets/js/70.4691f1a0.js"><link rel="prefetch" href="/Note/assets/js/71.a36676bb.js"><link rel="prefetch" href="/Note/assets/js/72.9b9e1977.js"><link rel="prefetch" href="/Note/assets/js/73.253966cf.js"><link rel="prefetch" href="/Note/assets/js/74.e8b23500.js"><link rel="prefetch" href="/Note/assets/js/75.14b4b03e.js"><link rel="prefetch" href="/Note/assets/js/76.4bd837ee.js"><link rel="prefetch" href="/Note/assets/js/77.19c2ae7f.js"><link rel="prefetch" href="/Note/assets/js/78.1f11225f.js"><link rel="prefetch" href="/Note/assets/js/79.0054c3d6.js"><link rel="prefetch" href="/Note/assets/js/8.02326ba6.js"><link rel="prefetch" href="/Note/assets/js/9.690f0bd8.js">
    <link rel="stylesheet" href="/Note/assets/css/0.styles.e7ea4a54.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Note/" class="home-link router-link-active"><!----> <span class="site-name">The Note of HelloWorldYC</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>matlab</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>无人机项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数字图像处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>信源数估计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Java基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Java框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>微服务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Note/Java/Java框架/微服务/微服务介绍.html" class="sidebar-link">微服务介绍</a></li><li><a href="/Note/Java/Java框架/微服务/Docker入门.html" class="active sidebar-link">Docker入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#初识-docker" class="sidebar-link">初识 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#docker-与虚拟机" class="sidebar-link">Docker 与虚拟机</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#镜像、容器、仓库" class="sidebar-link">镜像、容器、仓库</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#docker-架构" class="sidebar-link">Docker 架构</a></li></ul></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#docker-基本操作" class="sidebar-link">Docker 基本操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#示例" class="sidebar-link">示例</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#数据卷" class="sidebar-link">数据卷</a></li></ul></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#dockerfile-自定义镜像" class="sidebar-link">Dockerfile 自定义镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#镜像结构" class="sidebar-link">镜像结构</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#dockerfile" class="sidebar-link">Dockerfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#dockercompose" class="sidebar-link">DockerCompose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#什么是-dockercompose" class="sidebar-link">什么是 DockerCompose？</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#dockercompose-安装" class="sidebar-link">DockerCompose 安装</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#dockercompose-文件内容" class="sidebar-link">DockerCompose 文件内容</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#利用-dockercompose-部署微服务集群" class="sidebar-link">利用 DockerCompose 部署微服务集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#docker-镜像仓库" class="sidebar-link">Docker 镜像仓库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#简化版镜像仓库" class="sidebar-link">简化版镜像仓库</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#带有图形化界面版本" class="sidebar-link">带有图形化界面版本</a></li><li class="sidebar-sub-header"><a href="/Note/Java/Java框架/微服务/Docker入门.html#在私有镜像仓库推送或拉取镜像" class="sidebar-link">在私有镜像仓库推送或拉取镜像</a></li></ul></li></ul></li><li><a href="/Note/Java/Java框架/微服务/RabbitMQ入门.html" class="sidebar-link">RabbitMQ 入门</a></li><li><a href="/Note/Java/Java框架/微服务/Elasticsearch入门.html" class="sidebar-link">Elasticsearch入门</a></li></ul></section></li><li><a href="/Note/Java/Java框架/Kafka.html" class="sidebar-link">Kafka</a></li><li><a href="/Note/Java/Java框架/SpringSecurity.html" class="sidebar-link">Spring Security</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>校园信息交流平台项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>简易RPC框架项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>内功</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>知识点自测速记</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="初识-docker"><a href="#初识-docker" class="header-anchor">#</a> 初识 Docker</h2> <p>在大型项目中，组件往往较多，运行环境也较为复杂，部署时会碰到一些问题：</p> <ul><li>依赖关系复杂，容易出现兼容性问题</li> <li>开发、测试、生产环境有差异</li></ul> <p>Docker 是如何解决依赖关系复杂，容易出现兼容性问题的？</p> <ul><li>将应用的 Libs(函数库)、Deps(依赖)、配置与应用一起打包，形成可移植镜像</li> <li>将每个应用放到一个隔离容器去运行，避免互相干扰</li></ul> <p>Docker 是如何解决开发、测试、生产环境有差异的问题？</p> <ul><li>Docker 镜像中包含完整运行环境，包括系统函数库，仅依赖系统的 Linux 内核，因此可以在任意 Linux 操作系统上运行。</li></ul> <p>总的来说，Docker 是一个快速交付应用、运行应用的技术：</p> <ol><li>可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意 Linux 操作系统。</li> <li>运行时利用沙箱机制形成隔离容器，各个应用互不干扰。</li> <li>启动、移除都可以通过一行命令完成，方便快捷。</li></ol> <h3 id="docker-与虚拟机"><a href="#docker-与虚拟机" class="header-anchor">#</a> Docker 与虚拟机</h3> <p>虚拟机是在操作系统中模拟硬件设备，然后运行另一个操作系统，比如在 windows 系统中运行 Ubuntu 系统。</p> <div align="center"><img src="/Note/assets/img/Docker结构.317cc1b4.png" width="50%"><img src="/Note/assets/img/虚拟机结构.c1ce10c5.png" width="40%"></div> <p>两者对比：</p> <ul><li>性能：Docker 接近原生，虚拟机性能较差。</li> <li>硬盘占用：Docker 一般为 MB，虚拟机一般为 GB。</li> <li>启动：Docker 一般为秒级，虚拟机一般为分钟级。</li></ul> <h3 id="镜像、容器、仓库"><a href="#镜像、容器、仓库" class="header-anchor">#</a> 镜像、容器、仓库</h3> <p>镜像（Image）：Docker 将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。<br>
容器（Container）：镜像中的应用程序运行后形成的进程就是容器，只是 Docker 会给容器做隔离，对外不可见。<br>
仓库(Repository)：集中存放镜像的地方。DockerHub 就是这样一个 Docker 镜像的托管平台，类似的还有阿里云镜像服务，统称为 DockerRegistry。</p> <h3 id="docker-架构"><a href="#docker-架构" class="header-anchor">#</a> Docker 架构</h3> <p>Docker 是一个 CS 架构的程序，由两部分组成：</p> <ul><li>服务端（Server）：Docker 守护进程，负责处理 Docker 指令，管理镜像、容器等。</li> <li>客户端（Client）：通过命令或 RestAPI 向 Docker 服务端发送指令。可以在本地或远程向服务端发送指令。</li></ul> <h2 id="docker-基本操作"><a href="#docker-基本操作" class="header-anchor">#</a> Docker 基本操作</h2> <p>Doker 镜像名称一般分两部分组成：[repository]:[tag]，其中，tag 是指版本，在没有指定 tag 时，默认是 latest，代表最新版本的镜像。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker version          <span class="token comment"># 查看 docker 版本</span>
docker images           <span class="token comment"># 查看所有已下载镜像</span>
docker image <span class="token function">ls</span>         <span class="token comment"># 查看所有已下载镜像</span>
docker search mysql     <span class="token comment"># 查看 mysql 相关镜像</span>
docker pull mysql:5.7   <span class="token comment"># 拉取 mysql 镜像</span>
docker push <span class="token punctuation">[</span>image<span class="token punctuation">]</span>     <span class="token comment"># 推送镜像到 Registry</span>
docker build            <span class="token comment"># 构建镜像</span>
docker save             <span class="token comment"># 保存镜像为一个压缩包</span>
docker load             <span class="token comment"># 加载压缩包为镜像</span>
docker image prune      <span class="token comment"># 清理临时的、没有被使用的镜像文件</span>
docker rmi              <span class="token comment"># 删除镜像</span>

docker container <span class="token function">ls</span>     <span class="token comment"># 查看所有容器</span>
docker <span class="token function">ps</span>               <span class="token comment"># 查看正在运行的容器</span>
docker logs             <span class="token comment"># 查看容器运行日志，-f 参数可以持续查看日志</span>
docker <span class="token builtin class-name">exec</span>             <span class="token comment"># 进入容器执行命令</span>
docker run              <span class="token comment"># 将一个镜像启动为容器</span>
docker pause            <span class="token comment"># 暂停容器</span>
docker unpause          <span class="token comment"># 将暂停的容器启动</span>
docker start            <span class="token comment"># 启动容器</span>
docker stop             <span class="token comment"># 停止容器</span>
docker <span class="token function">rm</span>               <span class="token comment"># 删除指定容器，不能删除运行中的容器，除非添加 -f</span>
</code></pre></div><h3 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run --name containerName -p <span class="token number">80</span>:80 -d nginx
</code></pre></div><p>参数解读：</p> <ul><li><code>--name</code>：给容器起一个名字</li> <li><code>-p</code>：将宿主机端口与容器端口映射，冒号左侧是宿主机端口，右侧是容器端口</li> <li><code>-d</code>：在后台运行容器，一般都要添加</li> <li><code>nginx</code>：镜像名称</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>docker <span class="token builtin class-name">exec</span> -it mn <span class="token function">bash</span> 
</code></pre></div><p>参数解读：</p> <ul><li><code>-it</code>：给当前进入的容器创建一个标准输入、输出终端，允许我们与容器交互</li> <li><code>mn</code>：要进入的容器的名称</li> <li><code>bash</code>：进入容器后执行的命令，bash 是一个 Linux 终端交互命令</li></ul> <blockquote><p>exec 命令可以进入容器修改文件，但是在容器内修改文件是不推荐的。</p></blockquote> <h3 id="数据卷"><a href="#数据卷" class="header-anchor">#</a> 数据卷</h3> <p>为什么需要用到数据卷？原来的容器使用方式有什么问题？</p> <ol><li>不便于修改：当我们要修改容器内的某些数据时，需要进入容器内部修改，很不方便。</li> <li>数据不可复用：在容器内的修改对外是不可见的。所有修改对新创建的容器是不可复用的。</li> <li>升级维护困难：数据在容器内，如果要升级容器必然删除旧容器，所有数据都跟着删除了。</li></ol> <p>数据卷（volume）是一个虚拟目录，指向宿主机文件系统中的某个目录，它是由 Docker 进行管理的。当我们把数据卷挂载到容器内的某个目录后，我们在数据卷中做的修改都能够实时同步到容器中。</p> <p>数据卷操作的基本语法如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker volume <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span>
</code></pre></div><p><code>docker volume</code> 命令是数据卷操作，根据命令后跟随的 <code>COMMAND</code> 来确定下一步的操作：</p> <ul><li><code>create</code>：创建一个 volume。</li> <li><code>inspect</code>：显示一个或多个 volume 的信息。</li> <li><code>ls</code>：列出所有的 volume。</li> <li><code>prune</code>：删除未使用的 volume。</li> <li><code>rm</code>：删除一个或多个指定的 volume。</li></ul> <p>在创建容器时，可以通过 <code>-v</code> 参数来挂载一个数据卷到某个容器目录</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run <span class="token punctuation">\</span>
  -name mn <span class="token punctuation">\</span>
  -v html:/root/html <span class="token punctuation">\</span>    <span class="token comment"># 把 html 数据卷挂载到容器内的 /root/html 这个目录</span>
  -p <span class="token number">8080</span>:80 <span class="token punctuation">\</span> 
  nginx
</code></pre></div><p>此外，想要实现跟数据卷一样的功能，也可以直接将宿主机目录直接挂载到容器，其挂载的语法跟语句卷挂载是类似的：</p> <ul><li><code>-v [宿主机目录]:[容器内目录]</code></li> <li><code>-v [宿主机文件]:[容器内文件]</code></li></ul> <p>数据卷挂载和目录直接挂载的区别如下：</p> <ol><li>数据卷挂载耦合度低，由 docker 来管理目录，但是目录较深，不好找</li> <li>目录挂载耦合度高，需要我们自己管理目录，不过目录容易寻找查看</li></ol> <h2 id="dockerfile-自定义镜像"><a href="#dockerfile-自定义镜像" class="header-anchor">#</a> Dockerfile 自定义镜像</h2> <h3 id="镜像结构"><a href="#镜像结构" class="header-anchor">#</a> 镜像结构</h3> <p>要自定义镜像，首先肯定要先了解镜像结构。<br>
前面说过，镜像是将应用程序及其需要的系统函数库、环境配置、依赖打包而成。而它的结构是分层的，每一层称为一个 Layer。</p> <ul><li>BaseImage：应用依赖的系统函数库、环境、配置、文件等，因为基本都不会变，所以打包成一个基础镜像层。</li> <li>其他层：在 BaseImage 基础上添加安装包、依赖、配置等，每次操作都形成新的一层。</li> <li>入口（Entrypoint）：镜像运行入口，一般是程序启动的命令、脚本和参数。</li></ul> <h3 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h3> <p>Dockerfile 就是一个文本文件，其中包含一个个的指令，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层 Layer。
</p><div align="center"><img src="/Note/assets/img/Dockerfile指令.4e785835.png" width="100%"></div><p></p> <p>Dockerfile 文件示例：</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token comment"># 指定基础镜像</span>
<span class="token instruction"><span class="token keyword">FROM</span> ubuntu:16.04</span>
<span class="token comment"># 配置环境变量，JDK的安装目录</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_DIR=/usr/local</span>

<span class="token comment"># 拷贝jdk和java项目的包</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./jdk8.tar.gz <span class="token variable">$JAVA_DIR</span>/</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./docker-demo.jar /tmp/app.jar</span>

<span class="token comment"># 安装JDK</span>
<span class="token instruction"><span class="token keyword">RUN</span> cd <span class="token variable">$JAVA_DIR</span> <span class="token operator">\</span>
 &amp;&amp; tar -xf ./jdk8.tar.gz <span class="token operator">\</span>
 &amp;&amp; mv ./jdk1.8.0_144 ./java8</span>

<span class="token comment"># 配置环境变量</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME=<span class="token variable">$JAVA_DIR</span>/java8</span>
<span class="token instruction"><span class="token keyword">ENV</span> PATH=<span class="token variable">$PATH</span>:<span class="token variable">$JAVA_HOME</span>/bin</span>

<span class="token comment"># 暴露端口</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8090</span>
<span class="token comment"># 入口，java项目的启动命令</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> java -jar /tmp/app.jar</span>
</code></pre></div><p>注意：Dockerfile 的第一行必须是 FROM，从一个基础镜像来构建，基础镜像可以是基本操作系统，如 Ubuntu，也可以是其他人制作好的镜像，如 java:8-alpine。</p> <p>在编写好 dockerfile 后，可以使用 <code>docker build</code> 命令来构建镜像，以及使用 <code>docker run</code> 创建容器并运行。</p> <h2 id="dockercompose"><a href="#dockercompose" class="header-anchor">#</a> DockerCompose</h2> <h3 id="什么是-dockercompose"><a href="#什么是-dockercompose" class="header-anchor">#</a> 什么是 DockerCompose？</h3> <ul><li>Docker Compose 可以基于 Compose 文件帮我们快速的部署分布式应用，而无需手动一个个创建和运行容器。</li> <li>Docker Compose 本质也是一个文本文件，通过指令定义集群中的每个容器如何运行。</li></ul> <h3 id="dockercompose-安装"><a href="#dockercompose-安装" class="header-anchor">#</a> DockerCompose 安装</h3> <ol><li>要使用 DockerCompose 需要先安装，在 Linux 下可以通过命令安装:</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 安装</span>
<span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.29.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
</code></pre></div><ol start="2"><li>修改文件权限：</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 修改权限</span>
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div><ol start="3"><li>Base 自动补全命令</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 补全命令</span>
<span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre></div><h3 id="dockercompose-文件内容"><a href="#dockercompose-文件内容" class="header-anchor">#</a> DockerCompose 文件内容</h3> <p>DockerCompose 和 Dockerfile 文件的内容是一一对应的，只是语法结构不一样。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.2&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>           <span class="token comment"># 各种微服务</span>
  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos/nacos<span class="token punctuation">-</span>server   <span class="token comment"># nacos 微服务镜像</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MODE</span><span class="token punctuation">:</span> standalone          <span class="token comment"># nacos 模式：单机</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8848:8848&quot;</span>             <span class="token comment"># 容器内外端口映射</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.25
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                    <span class="token comment"># 数据卷挂载</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;$PWD/mysql/data:/var/lib/mysql&quot;</span>    
      <span class="token punctuation">-</span> <span class="token string">&quot;$PWD/mysql/conf:/etc/mysql/conf.d/&quot;</span>
  <span class="token key atrule">userservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./user<span class="token punctuation">-</span>service       <span class="token comment"># 会在这个目录下找 Dockerfile 构建镜像</span>
  <span class="token key atrule">orderservice</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./order<span class="token punctuation">-</span>service
  <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./gateway
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;10010:10010&quot;</span>
</code></pre></div><h3 id="利用-dockercompose-部署微服务集群"><a href="#利用-dockercompose-部署微服务集群" class="header-anchor">#</a> 利用 DockerCompose 部署微服务集群</h3> <ol><li>编写好 DockerCompose 文件，我们要对哪些微服务做部署要在文件中写好。</li> <li>修改自己的微服务项目，将数据库、Nacos 地址等都命名为 DockerCompose 中的服务名。</li> <li>将各个微服务编译好打包成 jar 包，拷贝到它们在微服务集群中对应的子目录中，jar 包名字要与子目录中的 Dockerfile 对应。</li> <li>将微服务集群文件夹上传至虚拟机，利用 <code>docker-compose up -d</code> 来部署。</li></ol> <h2 id="docker-镜像仓库"><a href="#docker-镜像仓库" class="header-anchor">#</a> Docker 镜像仓库</h2> <p>镜像仓库（Docker Registry）有公共的和私有的两种形式：</p> <ul><li>公共仓库：例如 Docker 官方的 DockerHub，国内也有一些云服务商提供类似于 Docker Hub 的公开服务，比如网易云镜像服务，DaoCloud 镜像服务，阿里云镜像服务等。</li> <li>私有仓库：除了使用公开仓库外，用户还可以在本地搭建私有 Docker Registry。企业自己的镜像最好是采用私有 Docker Registry 来实现。</li></ul> <h3 id="简化版镜像仓库"><a href="#简化版镜像仓库" class="header-anchor">#</a> 简化版镜像仓库</h3> <p>Docker 官方的 Docker Registry 是一个基础版本的 Docker 镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。搭建方式比较简单，命令如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker run -d <span class="token punctuation">\</span>
    --restart<span class="token operator">=</span>always <span class="token punctuation">\</span>
    --name registry	<span class="token punctuation">\</span>
    -p <span class="token number">5000</span>:5000 <span class="token punctuation">\</span>
    -v registry-data:/var/lib/registry <span class="token punctuation">\</span>
    registry
</code></pre></div><p>命令中挂载了一个数据卷 registry-data 到容器内的 /var/lib/registry  目录，这是私有镜像库存放数据的目录。</p> <p>访问 http://YourIp:5000/v2/_catalog 可以查看当前私有镜像服务中包含的镜像。</p> <h3 id="带有图形化界面版本"><a href="#带有图形化界面版本" class="header-anchor">#</a> 带有图形化界面版本</h3> <p>使用 DockerCompose 部署带有图形界面的 DockerRegistry，命令如下：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.0'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./registry<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/registry
  <span class="token key atrule">ui</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> joxit/docker<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>ui<span class="token punctuation">:</span>static
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">80</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> REGISTRY_TITLE=传智教育私有仓库
      <span class="token punctuation">-</span> REGISTRY_URL=http<span class="token punctuation">:</span>//registry<span class="token punctuation">:</span><span class="token number">5000</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> registry
</code></pre></div><h3 id="在私有镜像仓库推送或拉取镜像"><a href="#在私有镜像仓库推送或拉取镜像" class="header-anchor">#</a> 在私有镜像仓库推送或拉取镜像</h3> <p>推送镜像到私有镜像服务必须先 tag，步骤如下：</p> <ol><li>重新命名本地镜像，名称前缀为私有仓库的地址：192.168.150.101:8080/</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>docker tag nginx:latest <span class="token number">192.168</span>.150.101:8080/nginx:1.0
</code></pre></div><ol start="2"><li>推送镜像</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>docker push <span class="token number">192.168</span>.150.101:8080/nginx:1.0
</code></pre></div><ol start="3"><li>拉取镜像</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>docker pull <span class="token number">192.168</span>.150.101:8080/nginx:1.0
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Note/Java/Java框架/微服务/微服务介绍.html" class="prev">
        微服务介绍
      </a></span> <span class="next"><a href="/Note/Java/Java框架/微服务/RabbitMQ入门.html">
        RabbitMQ 入门
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Note/assets/js/app.1ed639b6.js" defer></script><script src="/Note/assets/js/3.e49e4a19.js" defer></script><script src="/Note/assets/js/23.3bc1de70.js" defer></script>
  </body>
</html>
